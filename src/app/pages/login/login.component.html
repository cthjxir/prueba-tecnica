<section class="login-page">
  <div class="login-left">
    <div class="login-card">
      @if (isLoggedIn) {
        <header class="login-header">
          <h1 class="login-title">Sesión iniciada</h1>
          <p class="login-subtitle">Has iniciado sesión correctamente</p>
        </header>
        <button class="logout-button" type="button" (click)="logout()">
          Cerrar sesión
        </button>
      } @else {
        <header class="login-header">
          <h1 class="login-title">Iniciar sesión</h1>
          <p class="login-subtitle">Ingresa tu usuario y contraseña</p>
        </header>

        <form class="login-form" (ngSubmit)="onSubmit()">
          <!-- Mensaje de error del login -->
          @if (hasLoginError) {
            <div class="error-message" role="alert">
              {{ loginErrorMessage }}
            </div>
          }

          <div class="field">
            <label for="username">Usuario</label>
            <input
              type="text"
              id="username"
              name="username"
              [(ngModel)]="username"
              (input)="clearLoginError()"
              placeholder="Ej: admin"
              autocomplete="username"
              [class.field-error]="hasLoginError && !username.trim()"
              [disabled]="isLoginLoading"
            />
          </div>
          <div class="field">
            <label for="password">Contraseña</label>
            <input
              type="password"
              id="password"
              name="password"
              [(ngModel)]="password"
              (input)="clearLoginError()"
              placeholder="••••••••"
              autocomplete="current-password"
              [class.field-error]="hasLoginError && !password.trim()"
              [disabled]="isLoginLoading"
            />
          </div>
          <button
            class="login-button"
            type="submit"
            [disabled]="isLoginLoading"
          >
            @if (isLoginLoading) {
              Entrando...
            } @else {
              Entrar
            }
          </button>
        </form>
      }

      <div class="state-box" aria-live="polite">
        <span class="state-box-label">Estado GET /me</span>
        @switch (meState.kind) {
          @case ("no-token") {
            <p class="state-box-value state-box-error">403 Forbidden</p>
            <p class="state-box-detail">No hay token</p>
          }
          @case ("loading") {
            <p class="state-box-value">Cargando…</p>
          }
          @case ("user") {
            <pre class="state-box-json">{{ meState.data | json }}</pre>
          }
          @case ("error") {
            <p class="state-box-value state-box-error">
              {{ meState.status }} {{ statusLabel(meState.status) }}
            </p>
            <p class="state-box-detail">{{ meState.message }}</p>
          }
        }
      </div>
    </div>
  </div>
  <div class="login-right" role="img" aria-label="Imagen de fondo"></div>
</section>
